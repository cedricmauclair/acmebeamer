% Time-stamp: <2011-06-22 14:08:25 cmauclai>
%
% Copyright 2010 by Cedric Mauclair
%
% This file may be distributed and/or modified
%
% 1. under the CCPL Attribution-ShareAlike License
% (http://creativecommons.org/licenses/by-sa/3.0/legalcode) and/or
% 2. under the GNU Public License 3 (http://www.gnu.org/licenses/gpl.html).
%
% Created by Cedric Mauclair for the 'acme' themes.
%
% Latest major version: 4.0
% Date: 2010-12-20
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Beamer theme ''acme-beamer'' (c) Cedric Mauclair, 2010.
%   * snippets from ''progressbar'' beamer theme (c) Sylvain Bouveret, 2009.
%   * snippets from ''leman'' beamer theme (c) David Chemouil, 2009.
%
% Version: 1.0   [2009-12-15]
%     First release.
% Version: 1.0.1 [2010-01-04]
%     Minor revision.
% Version: 1.1   [2010-01-05]
%     * Added an optional argument to maketitle command.
%     * Modified enumerate environment to pifont dings.
% Version: 1.2   [2010-02-23]
%     * Added a custom to bigbox to do whatever you want.
%     * Added the support for frame subtitles.
% Version: 2.0   [2010-11-22]
%     * Huge rewrite.
%     * Using 'pgfkeys' instead of 'xkeyval'.
% Version: 2.1   [2010-11-26]
%     Rewrote framedtext environment.
% Version: 3.0   [2010-12-20]
%     Huge rewrite of framed, framedtext and blocks.
% Version: 3.01  [2011-01-07]
%     Removed the iwona package requirement.
% Version: 3.02  [2011-01-13]
%     Reworked the frametitle: empty frametitles into (sub)sectioned
%     frametitles.
% Version: 4.0alpha [2011-02-04]
%     Reworked to work with the new toolbox.
% Version: 4.0 [2011-04-07]
%     Nothing changed, seems mature enough.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\ProvidesPackage{acmebeamer}[2011/02/04 Beamer theme tools.]
% \ProvidesPackageRCS $Header: acmebeamer.sty,v 4.0 2010/12/20 18:00:00 acme Exp$


%<< [· Required packages ·····················] >>

\RequirePackage{acmepkh}
\RequirePackage{acmetoolbox}
\RequirePackage{tikz}

\DeclareOption{portrait}{%
  \@tempdima=\beamer@paperwidth
  \beamer@paperwidth=\beamer@paperheight
  \beamer@paperheight=\@tempdima}

\DeclareOption{acmeblocks}{%
  \AtBeginDocument{\useacmeblocks}}

\DeclareOption{defaultblocks}{%
  \AtBeginDocument{\usebeamerblocks}}

\ExecuteOptions{defaultblocks}

\ProcessOptions

%>>
%<< [· Usefull definitions ···················] >>

\def\strutwd{\wd\strutbox}
\def\strutht{\ht\strutbox}
\def\strutdp{\dp\strutbox}

\newcommand\usebeamer[2][fg]
  {\usebeamerfont{#2}\usebeamercolor[#1]{#2}}

\renewenvironment{center}
  {\endgraf\centering} {\endgraf}

\def\slide#1 of #2{{\small(#1/#2)}}

\let\oldsetbeamersize\setbeamersize
\newdimen\leftmargin
\newdimen\rightmargin
\def\setbeamersize#1{
  \oldsetbeamersize{#1}
  \leftmargin\beamer@leftmargin
  \rightmargin\beamer@rightmargin
  \leftmargini\leftmargin
  \leftmarginii\labelsep
  \leftmarginiii\labelsep
  \labelwidth\leftmargini
  \advance\labelwidth by-\labelsep}

%>>
%<< [· Graphics utilities ····················] >>

\tikzset{bb/.style={use as bounding box}}

\newcommand\unitsquare[1][]{%
  \begin{tikzpicture}
    [baseline, x=1pt, y=1pt]
    \path [#1] (0,0) -- ++(1,0) -- ++(0,1) -- ++(-1,0) -- cycle;
  \end{tikzpicture}\ignorespaces}

\newcommand\fullsquare[1][]{%
  \begin{tikzpicture}
    [baseline, x=1pt, y=1pt]
    \path [#1] (-0.5,-0.5) -- ++(1,0) -- ++(0,1) -- ++(-1,0) -- cycle;
  \end{tikzpicture}\ignorespaces}

\newcommand\unitcircle[1][]{%
  \begin{tikzpicture}
    [baseline, x=1pt, y=1pt]
    \path [#1] (0.5,0.5) circle (0.5);
  \end{tikzpicture}\ignorespaces}

\newcommand\fullcircle[1][]{%
  \begin{tikzpicture}
    [baseline, x=1pt, y=1pt]
    \path [#1] (0,0) circle (0.5);
  \end{tikzpicture}\ignorespaces}

\newcommand\unittriangle[1][]{%
  \begin{tikzpicture}
    [baseline, x=1pt, y=1pt]
    \path [#1] (0,0) -- ++(1,0.5) -- ++(-1,0.5) -- cycle;
  \end{tikzpicture}\ignorespaces}

\newcommand\fulltriangle[1][]{%
  \begin{tikzpicture}
    [baseline, x=1pt, y=1pt]
    \path [#1] (0,-0.5) -- ++(1,0.5) -- ++(-1,0.5) -- cycle;
  \end{tikzpicture}\ignorespaces}

%<< * smileys factory                    >>

\tikzset{
  smiley/.style n args={3}{
    x=#1, y=#1, color=#2, very thick, rounded corners=1pt,
    line cap=round, parabola height=-1.6, #3}}

\newcommand\gsmiley[3][1mm]{%
  \begin{tikzpicture} [smiley={#1}{#2}{#3}]
    \path [draw, bb] (0, 0) circle (2.2);          % head
    \path [draw] (-1.2, -0.7) parabola ++(2.4, 0); % smile
    \path [fill] (-0.7,  0.6) circle (0.3);        % eye 1
    \path [fill] ( 0.7,  0.6) circle (0.3);        % eye 2
  \end{tikzpicture}}
\newcommand\wgsmiley[3][1mm]{%
  \begin{tikzpicture} [smiley={#1}{#2}{#3}]
    \path [draw, bb] (0, 0) circle (2.2);                % head
    \path [fill] (-1.5, -0.6) arc(200:340:1.6) -- cycle; % smile
    \path [draw] (-1.1,  0.5) -- ++( 0.7, 0.5);          % eye 1
    \path [draw] ( 1.1,  0.5) -- ++(-0.7, 0.5);          % eye 2
  \end{tikzpicture}}
\newcommand\wsmiley[3][1mm]{%
  \begin{tikzpicture} [smiley={#1}{#2}{#3}]
    \path [draw, bb] ( 0, 0) circle (2.2);             % head
    \path [fill=darkred] (-0.7, -0.5) -- ++(0, -0.3)
             arc (180:360:0.7) -- ++(0, 0.3) -- cycle; % tongue
    \path [fill] ( 0.7,  0.6) circle (0.3);            % eye 1
    \path [draw] (-1.1,  0.6) arc (200:340:0.4);       % eye 2
  \end{tikzpicture}}
% \newcommand\wmiley[3][1mm]{%
%   \begin{tikzpicture} [smileyenv={#1}{#2}{#3}]
%     \path [draw] ( 0,    0)   circle (2.2);        % head
%     \path [draw] (-1.2, -0.5) -- ++(2.4, 0);       % mouth
%     \path [fill] (-0.2, -0.5) -- ++(0, -0.3)
%              arc (180:360:0.6) -- ++(0, 0.3);      % tongue
%     \path [fill] ( 0.7,  0.6) circle (0.3);        % eye 1
%     \path [draw] (-1.1,  0.6) arc (200:340:0.4);   % eye 2
%   \end{tikzpicture}}
% \newcommand\wsmiley[3][1mm]{%
%   \begin{tikzpicture} [smileyenv={#1}{#2}{#3}]
%     \path [draw] ( 0,    0)   circle (2.2);        % head
%     \path [draw] (-1.2, -0.7) parabola ++(2.4, 0); % smile
%     \path [fill] ( 0.7,  0.6) circle (0.3);        % eye 1
%     \path [draw] (-1.1,  0.6) arc (200:340:0.4);   % eye 2
%   \end{tikzpicture}}
\newcommand\msmiley[3][1mm]{%
  \begin{tikzpicture} [smiley={#1}{#2}{#3}]
    \path [draw, bb] (0, 0) circle (2.2);   % head
    \path [draw] (-1  , -1) -- ++(2, 0.5);  % mouth
    \path [fill] (-0.7,  0.6) circle (0.3); % eye 1
    \path [fill] ( 0.7,  0.6) circle (0.3); % eye 2
  \end{tikzpicture}}
\newcommand\fsmiley[3][1mm]{%
  \begin{tikzpicture} [smiley={#1}{#2}{#3}]
    \path [draw, bb] (0, 0) circle (2.2);        % head
    \path [fill] (-0.7,  0.6) circle (0.3);      % eye 1
    \path [fill] ( 0.7,  0.6) circle (0.3);      % eye 2
    \path [draw] (-1.2, -1)   parabola +(2.4,0); % mouth
  \end{tikzpicture}}
\newcommand\csmiley[3][1mm]{%
  \begin{tikzpicture} [smiley={#1}{#2}{#3}]
    \path [draw, bb] (0, 0) circle (2.2);        % head
    \path [draw, fill, very thin, sharp corners, shift={(1.4, .8)}, scale=.2]
      (0, 0) to[controls=+(270:2)  and +(90:1)]  ++(-1, -4)
             to[controls=+(270:.1) and +(180:1)] ++(1, -1)
             to[controls=+(0:1)    and +(90:.1)] ++(1, 1)
             to[controls=+(90:1)   and +(270:2)] ++(-1, 4) ;
    \path [fill] (-0.7,  0.6) circle (0.3);      % eye 1
    \path [fill] ( 0.7,  0.6) circle (0.3);      % eye 2
    \path [draw] (-1.2, -1)   parabola +(2.4,0); % mouth
  \end{tikzpicture}}

\newcommand\grin[1][]{\gsmiley[3pt]{darkgreen}{#1}}
\newcommand\wide[1][]{\wgsmiley[3pt]{darkgreen}{#1}}
\newcommand\wink[1][]{\wsmiley[3pt]{darkgreen}{#1}}
\newcommand\mood[1][]{\msmiley[3pt]{darkorange}{#1}}
\newcommand\frwn[1][]{\fsmiley[3pt]{darkred}{parabola height=1.6, #1}}
\newcommand\whng[1][]{\csmiley[3pt]{darkred}{parabola height=1.6, #1}}

%>>
%<< * warn sign                          >>

\newcommand\warn[1][scale=1.5]{%
  \begin{tikzpicture}[%
    warning/.style={
      line width=2pt,
      draw=darkred, rounded corners,
      shape=isosceles triangle,
      shape border rotate=90,
      isosceles triangle apex angle=60,
      inner xsep=0pt,
      inner ysep=1.4pt,
      font=\fontfamily{qbk}\selectfont\bfseries,
      text=black, #1}]
    \node [warning] {!};
  \end{tikzpicture}}

%>>
%<< * \ok, \ko                           >>

\def\ok{{\color{darkgreen}\hbox to .9em{\ding{51}}}}
\def\ko{{\color{darkred}\hbox to .9em{\ding{55}}}}

%>>

%>>

\newcommand\setup[1]{\csname setup#1\endcsname}

%<< [· Title page ····························] >>

\declareadvancedparameters
  [titlepage]
  {logo/.is choice,
   logo/none/.code=\def\inserttitlegraphic{},
   logo/institute/.code=\def\inserttitlegraphic{\insertinstitute},
   customlogo/.code=\def\inserttitlegraphic{#1}}

\def\acmeframetitlehack{%
  \addtobeamertemplate{frametitle}{%
  \let\insertframetitleorig\insertframetitle
  \def\insertframetitle{%
    \ifx\insertframetitleorig\empty
      \ifx\subsecname\empty
        \ifx\secname\empty
        \else\secname\fi
      \else\subsecname\fi
    \else\insertframetitleorig\fi
  }}{}
  \def\beamer@checkframetitle{%
    \doifnextbgroupelse
    \beamer@inlineframetitle
    {\gdef\beamer@frametitle{none}}}}

\def\maketitle{\dodoubleempty\domaketitle}
\def\domaketitle[#1][#2]{%
  \setuptitlepage{#1}%
  \begin{frame}[c,plain,#2]\titlepage\end{frame}%
  \acmeframetitlehack
  \usebeamer{normal text}}

\def\setuptitlepage{\getparameters[titlepage]}

%>>
%<< [· Table of contents ·····················] >>

\newlength\frametocheight
\newlength\frametochmargin
\newlength\frametocvmargin

\def\frametoc{%
  \doifnextbgroupelse
    \doframetoc
    {\doframetoc{}}}

\def\doframetoc#1{%
  \doifnextoptionalelse
    {\dodoframetoc{#1}}
    {\dodoframetoc{#1}[]}}

\def\dodoframetoc#1[#2]{%
  \begin{frame}{#1}
    \parskip=0pt\vfill
    \usebeamer{frametoc}%
    \begin{framedtext}
      [frame=on, background=on,
       width=\hsize, minheight=50pt, offset=10pt,
       options={draw=fg!40, fill=bg, thin, rounded corners=2pt}]
         \vskip\partopsep\vskip-\topsep\vskip-2pt% WTF value
         \tableofcontents[#2]%
    \end{framedtext}\vfill%
  \end{frame}}

%>>
%<< [· Page number ···························] >>

%D Different options for the page numbers on the slides:
%D    - 'none': no page number
%D    - 'boxed': put the page number into a small box
%D    - 'plain': put the page number 'as is'
%D    - 'custom': use the supplied argument.

\declareadvancedparameters
  [pagenumbers]
  {style/.is choice, style/.default=plain,
   style/none/.code=\let\acme@pagenumbers\@empty,
   style/boxed/.code=\let\acme@pagenumbers\acme@pagenumbers@boxed,
   style/plain/.code=\let\acme@pagenumbers\acme@pagenumbers@plain,
   custom/.code=\def\acme@pagenumbers{#1}}

\let\acme@pagenumbers\@empty

\def\setuppagenumbers{\getparameters[pagenumbers]}

%D Boxed numbers

\def\acme@pagenumbers@boxed{\bgroup%
  \usebeamerfont{page number in head/foot}%
  \setbox0=\hbox{\strut00/00}\@tempdima=\wd0\@tempdimb=\ht0
  \multiply\@tempdima by 15\divide\@tempdima by 10%
  \multiply\@tempdimb by 2%
  \usebeamercolor{page number in head/foot}%
  \hbox\bgroup\begin{tikzpicture}%
    \node [rectangle, draw=fg, fill=bg, rounded corners=1pt, minimum width=\@tempdima,
           inner sep=0pt, outer sep=0pt, minimum height=\@tempdimb,
           text=fg, text depth=1pt]%
    {\setbox0=\hbox{\strut00}\@tempdima=\wd0%
      \usebeamerfont{page number in head/foot}\usebeamercolor[fg]{page number in head/foot}%
      \strut\hyperlinkpresentationstart{\hbox to\@tempdima{\hfill\insertframenumber}}/%
      \hyperlinkpresentationend{\hbox to\@tempdima{\inserttotalframenumber\hfill}}};
  \end{tikzpicture}\egroup\egroup}

%D Plain numbers

\def\acme@pagenumbers@plain{\bgroup%
  \usebeamerfont{page number in head/foot}\usebeamercolor[fg]{page number in head/foot}%
  \strut\hyperlinkpresentationstart{\insertframenumber}/%
  \hyperlinkpresentationend{\inserttotalframenumber}\egroup}

%>>

%<< [· Headline ······························] >>

%<< — setups ············· — >>

\declaresimpleparameters
  [headline]
  {stores={frame}}

\declareadvancedparameters
  [headline]
  {frame=,
   %% —————————————————————————————————————————————————— %%
   left/.is choice,
   left/empty/.code=\let\acme@headline@left\@empty,
   left/page numbers/.code=\let\acme@headline@left\acme@pagenumbers,
   left/custom/.code=\let\acme@headline@left\acme@headline@left@custom,
   left/predefined/.code=\acme@headline@predefined{left}{#1},
   left/.unknown/.code={%
     \let\acme@headline@left@predefined@key\pgfkeyscurrentname%
     \pgfkeysalso{\pgfkeyscurrentpath/predefined=\acme@headline@left@predefined@key}},
   %%
   left/section/.is choice, left/section/.default=text,
   left/section/text/.style={/acme/headline/left/predefined=section},
   left/subsection/.is choice, left/subsection/.default=text,
   left/subsection/text/.style={/acme/headline/left/predefined=subsection},
   left/subsection/bullets/.code=\let\acme@headline@left\acme@headline@subsection@bullets,
   left/subsection/squares/.code=\let\acme@headline@left\acme@headline@subsection@squares,
   %% —————————————————————————————————————————————————— %%
   center/.is choice,
   center/empty/.code=\let\acme@headline@center\@empty,
   center/page numbers/.code=\let\acme@headline@center\acme@pagenumbers,
   center/custom/.code=\let\acme@headline@center\acme@headline@center@custom,
   center/predefined/.code=\acme@headline@predefined{center}{#1},
   center/.unknown/.code={%
     \let\acme@headline@center@predefined@key\pgfkeyscurrentname%
     \pgfkeysalso{\pgfkeyscurrentpath/predefined=\acme@headline@center@predefined@key}},
   %%
   center/section/.is choice, center/section/.default=text,
   center/section/text/.style={/acme/headline/center/predefined=section},
   center/subsection/.is choice, center/subsection/.default=text,
   center/subsection/text/.style={/acme/headline/center/predefined=subsection},
   center/subsection/bullets/.code=\let\acme@headline@center\acme@headline@subsection@bullets,
   center/subsection/squares/.code=\let\acme@headline@center\acme@headline@subsection@squares,
   %% —————————————————————————————————————————————————— %%
   right/.is choice,
   right/empty/.code=\let\acme@headline@right\@empty,
   right/page numbers/.code=\let\acme@headline@right\acme@pagenumbers,
   right/custom/.code=\let\acme@headline@right\acme@headline@right@custom,
   right/predefined/.code=\acme@headline@predefined{right}{#1},
   right/.unknown/.code={%
     \let\acme@headline@right@predefined@key\pgfkeyscurrentname%
     \pgfkeysalso{\pgfkeyscurrentpath/predefined=\acme@headline@right@predefined@key}},
   %%
   right/section/.is choice, right/section/.default=text,
   right/section/text/.style={/acme/headline/right/predefined=section},
   right/subsection/.is choice, right/subsection/.default=text,
   right/subsection/text/.style={/acme/headline/right/predefined=subsection},
   right/subsection/bullets/.code=\let\acme@headline@right\acme@headline@subsection@bullets,
   right/subsection/squares/.code=\let\acme@headline@right\acme@headline@subsection@squares}

\def\setupheadline{\getparameters[headline]}

\let\acme@headline@left\@empty
\let\acme@headline@center\@empty
\let\acme@headline@right\@empty

\def\headlineleft{\def\acme@headline@left@custom}     \headlineleft{}
\def\headlinecenter{\def\acme@headline@center@custom} \headlinecenter{}
\def\headlineright{\def\acme@headline@right@custom}   \headlineright{}

%>>
%<< — sections ··········· — >>
\let\acme@headline@section\@empty
%>>
%<< — subsections ········ — >>

\def\acme@headline@subsection@bullets{%
  \@acme@headline@navigation}

\def\acme@headline@subsection@squares{%
  \setbeamertemplate{mini frame}{%
    \begin{pgfpicture}{0pt}{0pt}{0.1cm}{0.1cm}
      \pgfpathrectangle{\pgfpoint{0.0cm}{0.0cm}}{\pgfpoint{0.1cm}{0.1cm}}
      \pgfusepath{fill,stroke}
    \end{pgfpicture}}%
  \setbeamertemplate{mini frame in current subsection}{%
    \begin{pgfpicture}{0pt}{0pt}{0.1cm}{0.1cm}
      \pgfpathrectangle{\pgfpoint{0.0cm}{0.0cm}}{\pgfpoint{0.1cm}{0.1cm}}
      \pgfusepath{stroke}
    \end{pgfpicture}}\@acme@headline@navigation}

\let\acme@headline@subsection\@empty

%>>
%<< — predefined ········· — >>
\def\acme@headline@predefined#1#2{%
  \@EA\def\csname acme@headline@#1\endcsname
    {\usebeamertemplate{#2 in head/foot}}}
%>>
%<< -- UGLY HACK, BEWARE! IT DOESN'T WORK QUITE RIGHT FOR NOW >>

\def\@acme@headline@navigation{%
  \def\sectionentry##1##2##3##4##5{}% section number, section title, page
  \def\slideentry##1##2##3##4##5##6{%
    % section number, subsection number, slide number, first/last frame, page number, part number
    \ifnum##6=\c@part\ifnum##2>0\ifnum##3>0%
    \ifnum\c@section=##1\beamer@xpos=##2\relax%
    \else\beamer@xpos=0\relax\fi%
    \beamer@ypos=0\relax%
    \hbox to 0pt{%
      \beamer@tempdim=-\beamer@vboxoffset%
      \advance\beamer@tempdim by-\beamer@boxsize%
      \multiply\beamer@tempdim by\beamer@ypos%
      % \advance\beamer@tempdim by -.05cm%ACME FIX
      \raise\beamer@tempdim\hbox{%
        \beamer@tempdim=\beamer@boxsize%
        \multiply\beamer@tempdim by\beamer@xpos%
        \advance\beamer@tempdim by -\beamer@boxsize%
        \advance\beamer@tempdim by 1pt%
        \kern\beamer@tempdim\hbox{\beamer@link(##4){%
            \usebeamerfont{mini frame}%
            \ifnum\c@section=##1%
              \ifnum\c@subsection=##2%
                \usebeamercolor[fg]{mini frame}%
                \usebeamertemplate{mini frame}%
              \else%
                \usebeamercolor{mini frame}%
                \usebeamertemplate{mini frame in other subsection}%
              \fi%
            \fi%
          }}}%\hskip-10cm plus 1fil%
    }\fi\fi%
    \else%
    \fakeslideentry{##1}{##2}{##3}{##4}{##5}{##6}%
    \fi\ignorespaces}
  \def\fakeslideentry##1##2##3##4##5##6{%
    \ifnum##2>0\ifnum##3>0%
    \ifbeamer@compress%
    \advance\beamer@xpos by1\relax%
    \else%
    \beamer@xpos=##3\relax%
    \beamer@ypos=##2\relax%
    \fi%
    \hbox to 0pt{\beamer@tempdim=-\beamer@vboxoffset%
      \advance\beamer@tempdim by -\beamer@boxsize%
      \multiply\beamer@tempdim by\beamer@ypos%
      \advance\beamer@tempdim by -.05cm%
      \raise\beamer@tempdim\hbox{}}\fi\fi\ignorespaces}
  \hbox{%
    \setbox\beamer@sectionbox=\hbox{}%
    \hskip-1.875ex plus-1fill\dohead%
    \box\beamer@sectionbox\hfil\hskip.3cm}%
}

%>>

\defbeamertemplate{headline}{acme}{
  \setupframed{margin=0pt}
  \expandonearg\setupframed{\headlineframe}
  \let\next\@empty
  \ifnum\insertframenumber=1 \else
    \@tempdima=\framed@width
    \advance\@tempdima by -\framed@leftmargin%
    \advance\@tempdima by -\framed@rightmargin%
    \def\next{%
      \vskip\framed@topmargin
      \vbox\bgroup\strut
      \hskip\framed@leftmargin
      \hbox to \@tempdima\bgroup%
        \usebeamer{headline}%
        \hbox to \@tempdima{\acme@headline@left\hss}\hskip-\@tempdima
        \hbox to \@tempdima{\hss\acme@headline@center\hss}\hskip-\@tempdima
        \hbox to \@tempdima{\hss\acme@headline@right}
      \egroup\egroup
      \vskip\framed@bottommargin}
    \ifx\acme@headline@left\@empty
    \ifx\acme@headline@center\@empty
    \ifx\acme@headline@right\@empty
      \let\next\@empty\fi\fi\fi% nothing to show, then reclaim space
  \fi\next}

%>>
%<< [· Footline ······························] >>

%<< — setups ············· — >>

\declaresimpleparameters
  [footline]
  {stores={frame}}

\declareadvancedparameters
  [footline]
  {frame=,
   %% —————————————————————————————————————————————————— %%
   left/.is choice,
   left/empty/.code=\let\acme@footline@left\@empty,
   left/page numbers/.code=\let\acme@footline@left\acme@pagenumbers,
   left/custom/.code=\let\acme@footline@left\acme@footline@left@custom,
   left/predefined/.code=\acme@footline@predefined{left}{#1},
   left/.unknown/.code={%
     \let\acme@footline@left@predefined@key\pgfkeyscurrentname%
     \pgfkeysalso{\pgfkeyscurrentpath/predefined=\acme@footline@left@predefined@key}},
   %%
   left/section/.is choice, left/section/.default=text,
   left/section/text/.style={/acme/footline/left/predefined=section},
   left/subsection/.is choice, left/subsection/.default=text,
   left/subsection/text/.style={/acme/footline/left/predefined=subsection},
   left/subsection/bullets/.code=\let\acme@footline@left\acme@footline@subsection@bullets,
   left/subsection/squares/.code=\let\acme@footline@left\acme@footline@subsection@squares,
   %% —————————————————————————————————————————————————— %%
   center/.is choice,
   center/empty/.code=\let\acme@footline@center\@empty,
   center/page numbers/.code=\let\acme@footline@center\acme@pagenumbers,
   center/custom/.code=\let\acme@footline@center\acme@footline@center@custom,
   center/predefined/.code=\acme@footline@predefined{center}{#1},
   center/.unknown/.code={%
     \let\acme@footline@center@predefined@key\pgfkeyscurrentname%
     \pgfkeysalso{\pgfkeyscurrentpath/predefined=\acme@footline@center@predefined@key}},
   %%
   center/section/.is choice, center/section/.default=text,
   center/section/text/.style={/acme/footline/center/predefined=section},
   center/subsection/.is choice, center/subsection/.default=text,
   center/subsection/text/.style={/acme/footline/center/predefined=subsection},
   center/subsection/bullets/.code=\let\acme@footline@center\acme@footline@subsection@bullets,
   center/subsection/squares/.code=\let\acme@footline@center\acme@footline@subsection@squares,
   %% —————————————————————————————————————————————————— %%
   right/.is choice,
   right/empty/.code=\let\acme@footline@right\@empty,
   right/page numbers/.code=\let\acme@footline@right\acme@pagenumbers,
   right/custom/.code=\let\acme@footline@right\acme@footline@right@custom,
   right/predefined/.code=\acme@footline@predefined{right}{#1},
   right/.unknown/.code={%
     \let\acme@footline@right@predefined@key\pgfkeyscurrentname%
     \pgfkeysalso{\pgfkeyscurrentpath/predefined=\acme@footline@right@predefined@key}},
   %%
   right/section/.is choice, right/section/.default=text,
   right/section/text/.style={/acme/footline/right/predefined=section},
   right/subsection/.is choice, right/subsection/.default=text,
   right/subsection/text/.style={/acme/footline/right/predefined=subsection},
   right/subsection/bullets/.code=\let\acme@footline@right\acme@footline@subsection@bullets,
   right/subsection/squares/.code=\let\acme@footline@right\acme@footline@subsection@squares}

\def\setupfootline{\getparameters[footline]}

\let\acme@footline@left\@empty
\let\acme@footline@center\@empty
\let\acme@footline@right\@empty

\def\footlineleft{\def\acme@footline@left@custom}     \footlineleft{}
\def\footlinecenter{\def\acme@footline@center@custom} \footlinecenter{}
\def\footlineright{\def\acme@footline@right@custom}   \footlineright{}

%>>
%<< — predefined ········· — >>

\def\acme@footline@predefined#1#2{%
  \@EA\def\csname acme@footline@#1\endcsname
    {\usebeamertemplate{#2 in head/foot}}}

%>>

\defbeamertemplate{footline}{acme}{
  \setupframed{margin=0pt}
  \expandonearg\setupframed{\footlineframe}
  \let\next\@empty
  \ifnum\insertframenumber=1 \else
    \@tempdima=\framed@width
    \advance\@tempdima by -\framed@leftmargin%
    \advance\@tempdima by -\framed@rightmargin%
    \def\next{%
      \vskip-\framed@bottommargin
      \vskip\framed@topmargin
      \vbox\bgroup\vss\strut
      \hskip\framed@leftmargin
      \hbox to \@tempdima\bgroup
        \usebeamer{footline}%
        \hbox to \@tempdima{\acme@footline@left\hss}\hskip-\@tempdima
        \hbox to \@tempdima{\hss\acme@footline@center\hss}\hskip-\@tempdima
        \hbox to \@tempdima{\hss\acme@footline@right}
      \egroup\egroup
      \vskip\framed@bottommargin}
    \ifx\acme@footline@left\@empty
    \ifx\acme@footline@center\@empty
    \ifx\acme@footline@right\@empty
      \let\next\@empty\fi\fi\fi% nothing to show, then reclaim space
  \fi\next}

%>>
%<< [· Frametitle ····························] >>

\defbeamertemplate{frametitle}{acme}[1]{#1}

%>>

%<< [· Emphasis ······························] >>

% BEWARE: VERY UGLY HACK BELOW
\def\emstyle{\def\@emstyle}
\emstyle{\usebeamerfont{emphasis}\usebeamercolor[fg]{emphasis}}
% \emstyle{\usebeamerfont{emphasis}\color{fg}}
\DeclareRobustCommand\em
{\@nomath\em \ifdim \fontdimen\@ne\font >\z@
  \color{normal text.fg}\mdseries \else\@emstyle \fi}
\let\beamer@orignewcomnoopt=\beamer@newcomnoopt
\let\beamer@orignewcomopt=\beamer@newcomopt
\long\def\beamer@newcomnoopt#1#2#3{%
  \ifnum#2=0\relax%
  \expandafter\def\expandafter#1\expandafter{\expandafter\beamer@sortzero\expandafter{\csname beamerx@\string#1\endcsname}}%
  \else
  \expandafter\def\expandafter#1\expandafter{\expandafter\beamer@sort\expandafter{\csname beamerx@\string#1\endcsname}{#2}}%
  \fi%
  \beamer@argscount=#2\relax%
  \advance\beamer@argscount by 1\relax%
  \expandafter\renewcommand\csname beamerx@\string#1\endcsname[\beamer@argscount]{#3}%
}
\long\def\beamer@newcomopt#1#2[#3]#4{%
  \expandafter\def\expandafter#1\expandafter{\expandafter\beamer@presort\expandafter{\csname beamerx@\string#1\endcsname}{#2}{#3}}%
  \beamer@argscount=#2\relax%
  \advance\beamer@argscount by 1\relax%
  \expandafter\renewcommand\csname beamerx@\string#1\endcsname[\beamer@argscount]{#4}%
}
\renewcommand<>{\emph}[1]{{\only#2{\em}#1}}

\let\beamer@newcomnoopt=\beamer@orignewcomnoopt
\let\beamer@newcomopt=\beamer@orignewcomopt
\setbeamerfont{emphasis}{series=\bf,shape=\rm}

%>>
%<< [· Blocks ································] >>

\let\blockorig\block
\let\alertblockorig\alertblock
\let\exampleblockorig\exampleblock
\let\endblockorig\endblock
\let\endalertblockorig\endalertblock
\let\endexampleblockorig\endexampleblock

%<< — macros{defineblock, defineblocks} · — >>

\declareadvancedparameters
  [blocks]
  {alignbox/.is choice,
   alignbox/right/.code=
     \let\acmeblocksleft\@empty\let\acmeblocksright\hfill,
   alignbox/left/.code=
     \let\acmeblocksleft\hfill\let\acmeblocksright\@empty,
   alignbox/center/.code=
     \let\acmeblocksleft\hfill\let\acmeblocksright\hfill,
   alignbox/flushright/.style={alignbox=left},
   alignbox/flushleft/.style={alignbox=right}}

\def\blocksparameters{%
  width,
  align,
  color,
  % frame
  frame,
  customframe,
  background,
  custombackground,
  frameoptions,
  % title
  titleframe,
  titlecustomframe,
  titlebackground,
  titlecustombackground,
  titleoptions,
  titlecolor,
  titlestyle,
  titlealign,
  % body
  bodyframe,
  bodycustomframe,
  bodybackground,
  bodycustombackground,
  bodyoptions,
  bodycolor,
  bodystyle,
  bodyheight,
  bodyalign}

\def\defineblocks{\dodoubleargumentwithset\dodefineblock}

\def\defineblock{\dodoubleempty\dodefineblock}
\def\dodefineblock[#1][#2]{%
  \iffirstargument
    \def\current{#1}%
    \ifsecondargument
      \ifx\relax#2\relax% second argument supplied but empty
        \expanded{\copyrawparameters[\current block][blocks][\blocksparameters]}%
      \else
        \doifassignmentelse{#2}
          {\expanded{\copyrawparameters[\current block][blocks][\blocksparameters]}%
           \getrawparameters[\current block]{#2}}
          {\expanded{\copyrawparameters[\current block][#2block][\blocksparameters]}}%
      \fi
    \else
      \expanded{\copyrawparameters[\current block][blocks][\blocksparameters]}%
    \fi
  \fi
  \expanded{\dodefineblockindeed
    {#1}
    {block \ifx\current\@empty\else\current\space\fi begin}
    {block \ifx\current\@empty\else\current\space\fi end}
    {block title\ifx\current\@empty\else\space\current\fi}
    {block body\ifx\current\@empty\else\space\current\fi}}}

%>>
%<< — macros{setupblock, setupblocks} ··· — >>

\newcommand\setupblocks[1][]{%
  \ifx\relax#1\relax
    \def\next{\getparameters[blocks]}%
  \else
    \def\next{\dodoubleargumentwithset\dosetupblock[#1]}%
  \fi\next}

\newcommand\setupblock[1][]{\getrawparameters[#1block]}

%>>
%<< — macros{dodefineblockindeed} ······· — >>

%D One can define its own \dodefineblockindeed to whatever (s)he wishes.
%D It will be given 5 parameters:
%D   1. name of the block (\defineblock[name], use \begin{nameblock});
%D   2. name of the template put at the beginning (block begin);
%D   3. name of the template put at the end (block end);
%D   3. name of the template for the title (block title);
%D   3. name of the template for the body (block body).

\newbox\blocksbodybox
\newbox\blockstitlebox
\def\c@@default{default}

\def\dodefineblockindeed#1#2#3#4#5{%
  \def\current{#1}\ifx\current\c@@default\relax\let\current\@empty\fi%
  \@EA\edef\csname \current block\endcsname{%
    \noexpand\doifnextbgroupelse
      {\csname do\current block\endcsname}
      {\csname do\current block\endcsname{}}}%
  \@EA\long\@EA\edef\csname do\current block\endcsname##1{%
    \noexpand\doifnextoptionalelse
      {\csname dodo\current block\endcsname{\noexpand##1}}
      {\csname dodo\current block\endcsname{\noexpand##1}[]}}%
  \@EA\long\@EA\def\csname dodo\current block\endcsname##1[##2]{%
    \blank[quater]
    \begingroup
    \raggedright
    \addtobeamertemplate{itemize/enumerate body begin}{\fixvspacehard}{}%
    \addtobeamertemplate{itemize/enumerate body end}{}{\fixvspacehard}%
    \setupblock[#1]{##2}%
    % [·adjust size of text: width, height & depth·]
    \setlencs\blockswd{\getvalue{#1blockwidth}}
    \setbeamercolor{item}{use=#1blockitems, fg=#1blockitems.fg}%
    \def\insertblocktitle{##1}%
    % [·let's go for the definition of a block·]
    \usefgorcolor{\getvalue{#1blockcolor}}%
    \expanded{\setupframed{offset=0pt, \getvalue{#1blockframeoptions}}}%
    % [·the body first·]
    \setbox\nextbox=\vbox\bgroup
      \expanded{\begin{framedtext}
          [width=\blockswd-\framed@leftoffset-\framed@rightoffset,
           height=\getvalue{#1blockbodyheight},
           offset=0pt, maxheight=\paperheight,
           align={\getvalue{#1blockbodyalign}},
           \getvalue{#1blockbodyoptions}},
           frame/custom=\getvalue{#1blockbodycustomframe},
           background/custom=\getvalue{#1blockbodycustombackground},
           frame=on, background=on]
          \vskip-\parskip
          \usefgorcolor{\getvalue{#1blockbodycolor}}%
          \getvalue{#1blockbodystyle}\ignorespaces}%
  \@EA\def\csname end\current block\endcsname{%
    \end{framedtext}\egroup%
    % [·alignment·]
    \setupblocks{alignbox=\getvalue{#1blockalign}}%
    \setbox\blocksbodybox=\box\nextbox
    % [·then the title·]
    \expanded{\setupframed{\getvalue{#1blockframeoptions}}}%
    \setbox\blockstitlebox=\vbox\bgroup
      \hsize=\blockswd
      \ifx\insertblocktitle\@empty\else
        \expanded{\begin{framedtext}
          [width=\hsize-\framed@leftoffset-\framed@rightoffset,
           align={\getvalue{#1blocktitlealign}},
           offset=0pt, \getvalue{#1blocktitleoptions}},
           frame/custom=\getvalue{#1blocktitlecustomframe},
           background/custom=\getvalue{#1blocktitlecustombackground},
           frame=on, background=on]
          \usefgorcolor{\getvalue{#1blocktitlecolor}}%
          \getvalue{#1blocktitlestyle}%
          \insertblocktitle
         \end{framedtext}\fi
    \egroup
    % [·and the whole box·]
    \vrule width0pt\acmeblocksleft
    \expanded{\begin{framedtext}
        [width=\blockswd, offset=0pt, \getvalue{#1blockframeoptions}},
         frame/custom=\getvalue{#1blockcustomframe},
         background/custom=\getvalue{#1blockcustombackground},
         frame=on, background=on]
        \hsize=\blockswd
        \vskip-\parskip\box\blockstitlebox
        \ifx\insertblocktitle\@empty\else\vskip-\parskip\fi
        \box\blocksbodybox
      \end{framedtext}%
    \acmeblocksright\vrule width0pt
    \endgroup
    \blank[quater]
}}

%>>

\def\fixvspace{\vskip-0.5\topsep}
\def\fixvspacehard{\kern-0.5\topsep}

%>>
%<< [· Items ·································] >>

% prevent babel french.ldf from meddling with my itemizes
\AtBeginDocument{%
  \ifx\iflanguage\undefined\else
    \iflanguage{french}{\frenchbsetup{StandardLists=true}
  \fi}{}}

\def\usesquareitems{%
  \setbeamertemplate{itemize item}
    {\unitsquare[draw, scale=5, yshift=.2]}
  \setbeamertemplate{itemize subitem}
    {\unitsquare[draw, scale=4, yshift=.25]}
  \setbeamertemplate{itemize subsubitem}
    {\unitsquare[draw, scale=3, yshift=.3333]}}

\def\usecircleitems{%
  \setbeamertemplate{itemize item}
    {\unitcircle[draw, scale=5, yshift=.2]}
  \setbeamertemplate{itemize subitem}
    {\unitcircle[draw, scale=4, yshift=.25]}
  \setbeamertemplate{itemize subsubitem}
    {\unitcircle[draw, scale=3, yshift=.3333]}}

\def\usetriangleitems{%
  \setbeamertemplate{itemize item}
    {\unittriangle[draw, scale=5, yshift=.2]}
  \setbeamertemplate{itemize subitem}
    {\unittriangle[draw, scale=4, yshift=.25]}
  \setbeamertemplate{itemize subsubitem}
    {\unittriangle[draw, scale=3, yshift=.3333]}}

\def\usefilledsquareitems{%
  \setbeamertemplate{itemize item}
    {\unitsquare[fill, scale=5, yshift=.2]}
  \setbeamertemplate{itemize subitem}
    {\unitsquare[fill, scale=4, yshift=.25]}
  \setbeamertemplate{itemize subsubitem}
    {\unitsquare[fill, scale=3, yshift=.3333]}}

\def\usefilledcircleitems{%
  \setbeamertemplate{itemize item}
    {\unitcircle[fill, scale=5, yshift=.2]}
  \setbeamertemplate{itemize subitem}
    {\unitcircle[fill, scale=4, yshift=.25]}
  \setbeamertemplate{itemize subsubitem}
    {\unitcircle[fill, scale=3, yshift=.3333]}}

\def\usefilledtriangleitems{%
  \setbeamertemplate{itemize item}
    {\unittriangle[fill, scale=5, yshift=.2]}
  \setbeamertemplate{itemize subitem}
    {\unittriangle[fill, scale=4, yshift=.25]}
  \setbeamertemplate{itemize subsubitem}
    {\unittriangle[fill, scale=3, yshift=.3333]}}

\defbeamertemplate*{itemize item}{acme}
  {\unitsquare[fill, scale=5, rounded corners=1, yshift=.2]}
\defbeamertemplate*{itemize subitem}{acme}
  {\unittriangle[fill, scale=4, rounded corners=.2, yshift=.25]}
\defbeamertemplate*{itemize subsubitem}{acme}
  {\unittriangle[draw, scale=3, rounded corners=.2, yshift=.3333]}

%>>
%<< [· Enumerate ·····························] >>

\setbeamertemplate{enumerate item}{\insertenumlabel.}

% Patch to reset the counter on each enumerate
\def\beamer@enum@{%
  \csname c@\@enumctr\endcsname0% QUICKFIX strange bug, don't reset the counter
  \beamer@computepref\@itemdepth% sets \beameritemnestingprefix
  \usebeamerfont{itemize/enumerate \beameritemnestingprefix body}%
  \usebeamercolor[fg]{itemize/enumerate \beameritemnestingprefix body}%
  \usebeamertemplate{itemize/enumerate \beameritemnestingprefix body begin}%
  \expandafter
    \list
      {\usebeamertemplate{\beamer@enumtempl}}
      {\usecounter\@enumctr%
        \def\makelabel##1{{\hss\llap{{%
                \usebeamerfont*{enumerate \beameritemnestingprefix item}%
                \usebeamercolor[fg]{enumerate \beameritemnestingprefix item}##1}}}}}%
  \beamer@cramped%
  \raggedright%
  \beamer@firstlineitemizeunskip%
}

%>>

%<< [· Basic templates ·······················] >>

%<< — helpers ············ — >>

\def\acme@template@complex#1{\@ifnextchar[{\doacme@template@complex{#1}}{\doacme@template@complex{#1}[#1]}}
\def\doacme@template@complex#1[#2]#3#4#5#6{
  \defbeamertemplate*{#1}{acme}{%
    #5{\usebeamerfont{#1}\usebeamercolor[fg]{#1}#3\csname insert#2\endcsname#4}#6}}

\def\acme@template@simple#1{\@ifnextchar[{\doacme@template@simple{#1}}{\doacme@template@simple{#1}[#1]}}
\def\doacme@template@simple#1[#2]{\acme@template@complex{#1}[#2]{}{}{}{}}

%>>

% titlepage templates
\acme@template@simple{institute}
\acme@template@simple{title}
\acme@template@simple{subtitle}
\acme@template@simple{author}
\acme@template@simple{date}

% head/footline templates
% {#1}=beamer template name,
% [#2]=used in \insert#2, defaults to #1 if not given.
\acme@template@simple{section in head/foot}[section]
\acme@template@simple{subsection in head/foot}[subsection]
\acme@template@simple{title in head/foot}[shorttitle]
\acme@template@simple{subtitle in head/foot}[shortsubtitle]
\acme@template@simple{author in head/foot}[shortauthor]
\acme@template@simple{date in head/foot}[shortdate]

\setbeamertemplate{navigation symbols}{}
\defbeamertemplate*{navigation symbols in head/foot}{acme}{%
  {\usebeamerfont{navigation symbols in head/foot}
    \usebeamercolor[fg]{navigation symbols in head/foot}
    \insertslidenavigationsymbol \insertframenavigationsymbol
    \insertsubsectionnavigationsymbol \insertsectionnavigationsymbol
    \insertdocnavigationsymbol \insertbackfindforwardnavigationsymbol}}

% table of contents templates
% {#1}=beamer template name,
% [#2]=used in \insert#2, defaults to #1 if not given,
% {#3}=before \insert___, {#4}=after \insert___, typeset with
%                                                color and font of #1
% {#5}=before \insert___ and #3, {#6}=after \insert___ and #4,
%                                    typeset with current color and font
\acme@template@complex{section in toc}[tocsection]%
  {}{}
  {\vskip12pt plus6pt minus6pt\leavevmode\usebeamertemplate{itemize item}\hskip\labelsep}{}
\acme@template@complex{subsection in toc}[tocsubsection]%
  {}{}
  {\vskip3pt plus3pt minus3pt\leavevmode\hskip\leftmarginii
    \usebeamertemplate{itemize subitem}\hskip\labelsep}{\endgraf}

%>>
%<< [· Enhanced itemizes: sitemize ···········] >>

\def\sitemize{%
  \doifnextoptionalelse
    {\dositemize}
    {\dositemize[1]}}
\def\dositemize[#1]{%
  \doifnextoptionalelse
    {\dodositemize[#1]}
    {\dodositemize[#1][]}}
\def\dodositemize[#1][#2]{%
  \begingroup
  \advance\@itemdepth by -1
  \advance\@itemdepth by #1
  \begin{itemize}[#2]}

\def\endsitemize{%
  \end{itemize}
  \endgroup}

%>>
%<< [· Highlighting text ·····················] >>

\usetikzlibrary[fit]

\pgfdeclarelayer{background}
\pgfsetlayers{background,main}

\tikzset{hl/.style=
  {overlay, sharp corners, fill=green!35,
    very thick, inner xsep=1pt, inner ysep=2pt}}

\newcommand<>\hl[2][]{%
  \ifmmode \setbox0=\hbox{\ensuremath{#2}}
  \else    \setbox0=\hbox{#2}\fi \dp0=0pt
  \begin{tikzpicture}[remember picture]
    \node[inner sep=0pt] (mark) {\box0};
    \only#3
      {\begin{pgfonlayer}{background}
         \node[hl, #1, fit=(mark)] {};
       \end{pgfonlayer}}
  \end{tikzpicture}}

\newcommand\placehlmark[2][mark]{%
  \ifmmode \setbox0=\hbox{\strut\ensuremath{#2}}
  \else    \setbox0=\hbox{\strut#2}\fi \dp0=0pt
  \begin{tikzpicture}[remember picture]
    \node[anchor=text, inner sep=0pt] (#1) {\box0};
  \end{tikzpicture}}

\newcommand<>\hlmarks[2][ellipse]{%
  \begin{tikzpicture}[remember picture, overlay]
    \only#3{\node [draw=darkorange, line width=1.6pt, #1, fit=#2] {};}
  \end{tikzpicture}}

%>>

\def\usefgorcolor#1{%
  \ifbeamercolorempty[fg]{#1}%
  {\definecolor{fg}{named}{#1}\color{#1}}%
  {\usebeamercolor[fg]{#1}}}

\def\useordefinefgbgcolor#1{%
  \ifbeamercolorempty[fg]{#1}%
  {\definecolor{fg}{named}{#1}\definecolor{bg}{named}{bg}}%
  {\usebeamercolor{#1}}}

\setbeamercolor {emphasis}          {parent=normal text}
\setbeamercolor {defaultblockitems} {parent=structure}%,    fg=structure.fg!70}
\setbeamercolor {alertblockitems}   {parent=alerted text}%, fg=alerted text.fg!70}
\setbeamercolor {exampleblockitems} {parent=example text}%, fg=example text.fg!70}
\setbeamercolor {emphasisblockitems}{parent=emphasis}



% [·blocks·]
\defineblock [default]  [color=structure,    titlecolor=block title]
\defineblock [alert]    [color=alerted text, titlecolor=block title alerted]
\defineblock [example]  [color=example text, titlecolor=block title example]
\defineblock [emphasis] [color=emphasis,     titlecolor=emphasis]

\let\defaultblockacme\block
\let\alertblockacme\alertblock
\let\exampleblockacme\exampleblock
\let\enddefaultblockacme\endblock
\let\endalertblockacme\endalertblock
\let\endexampleblockacme\endexampleblock

\setupblocks{%
  width=\hsize,
  align=center,
  frameoptions=,
  titleoptions=,
  bodyoptions=,
  titlecolor=block title,
  bodycolor=normal text,
  bodyheight=-1pt,
  titlestyle=\usebeamerfont{block title},
  bodystyle=\usebeamerfont{block body},
  titlealign=default,
  bodyalign={default, middle}
}

\def\usebeamerblocks{%
  \AtBeginDocument{%
    \let\block\blockorig
    \let\alertblock\alertblockorig
    \let\exampleblock\exampleblockorig
    \let\endblock\endblockorig
    \let\endalertblock\endalertblockorig
    \let\endexampleblock\endexampleblockorig}}

\def\useacmeblocks{%
  \AtBeginDocument{%
    \let\block\defaultblockacme
    \let\alertblock\alertblockacme
    \let\exampleblock\exampleblockacme
    \let\endblock\enddefaultblockacme
    \let\endalertblock\endalertblockacme
    \let\endexampleblock\endexampleblockacme}}

\let\secname\@empty
\let\subsecname\@empty


%%% Local Variables:
%%% TeX-master: "./demo.tex"
%%% End:
